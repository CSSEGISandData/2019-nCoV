---
title: "COVID-19 in Various U.S. Regions"
author: "Morgana Kinlan"
date: "March 23, 2020"
output: html_document
---

###Data Sources

To examine COVID-19 data, I first created my own GitHub repository as a fork from the [Novel Coronavirus (COVID-19) Cases public github repository](https://github.com/CSSEGISandData/COVID-19/blob/master/README.md) provided by the Johns Hopkins University Center for Systems Science and Engineering (JHU CSSE). Their repo is also supported by ESRI Living Atlas Team and the Johns Hopkins University Applied Physics Lab (JHU APL).

My public GitHub repo, which includes data used, can be found here: https://github.com/mkinlan/COVID-19

###Connecting R to GitHub

After creating my public repo, I created a new project in R Studio and connected it to my GitHub repo. Connecting directly through R Studio allows me to pull fresh data from the JHU repo, which is updated daily, rather than having to re-clone the repo each day or manually download CSV files. 

For help connecting R Studio to GitHub, see Ch.12 of [Happy Git and GitHub for the useR](https://happygitwithr.com/rstudio-git-github.html).

####R Libraries

After setting up the project, I loaded the libraries into R Studio that would be needed for the first section: 

```{r, warning= FALSE, message=FALSE}
library(readr)
library(dplyr)
library(tidyverse)
library(tidyr)
library(lubridate)
library(ggthemes)
```

Next, I loaded in time series data of confirmed COVID-19 cases from my GitHub repo. The time series CSV file shows the total number of confirmed cases from around the world, recorded by country and aggregated from the province or state level. 

```{r, warning=FALSE, message=FALSE, echo=TRUE, results='hide'}
#Reading in time series data for the world, cloned from GitHub
confirm <- read_csv("csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv")
names(confirm)
head(confirm)
```

I currently live in Maryland and wanted to see data about my home state, so once the data was imported, I filtered it down to just the United States and just the state of Maryland.


```{r, warning=FALSE, message=F, echo=T, results='hide'}

#filtering down to just United States
md<-confirm %>% filter(`Country/Region`=="US" & `Province/State`=="Maryland")
head(md)
```

###Reshaping for a Bar Chart
As the results above show, the Maryland-only data was very wide (only 1 row, but 65 columns). This format makes a lot of sense from a real-time data collection standpoint.However, this format makes it difficult to plot out in R. 

I wanted to be able to plot all of the confirmed cases by date. R views column names as variables, so in the current data format, each date would be a separate variable for a total of 65 variables. 

This wouldn't work for making something like a standard bar chart, which uses only one x variable and one y variable, so I decided to reshape the Maryland data into something more usable. 

```{r}
#reshaping wide Cartesian view into long indexed view

md<-md[,-c(2:4)]#Removing country, lat, long cols
names(md)[1]<-"State" #renaming for easier coding
md_short<-md %>% gather(Date, Confirmed, "1/22/20":"3/22/20")
```

I didn't need the country, latitude, or longitude variable columns for the bar chart, so I removed those from the dataframe. Then I transposed the wide maryland data into a long indexed form with only 3 columns: "State", "Date" and "Confirmed". These last two columns were created with the gather() function.

The gather() function placed all of the data from columns "1/22/20" through "3/22/20" into two newly formed columns, which I named "Date" and "Confirmed". Now, instead of having each date as it's own separate variable, each date column name would be listed under the single new "Date" variable. The accompanying row 1 data under each date column name was gathered under the new "Confirmed" column.

Here is the result:

```{r}
head(md_short)
```

Next, I used the ggplot2 library to create a bar plot showng the number of confirmed COVID-19 cases over time:

```{r}
md_short$Date<-as.Date(md_short$Date, "%m/%d/%y")#turning from char to date

#Plot showing difference from one month ago to today
p<-ggplot(md_short, aes(Date,Confirmed))
p<-p+geom_bar(stat="identity")
p
```

After first creating the initial plot, p, I quickly realized that it would be better to change the x-axis limits to only the dates when COVID-19 first started to appear in Maryland. 

I also added a title, subtitle, and adjusted the overall look and feel by changing the theme() function. 

```{r, warning=F, error=F, message=F}
p_short<-p + xlim(as.Date(c("2020-03-01", "2020-03-24"), format="%Y-%m-%d")) #only showing time since infection started
p_titles<-p_short + labs(x=NULL, y="Infected People", title="Confirmed COVID-19 Cases in Maryland", subtitle = "github.com/mkinlan/COVID-19.git")
p_titles + theme_economist()
```


###Mapping Daily Data
```{r}
library(raster)
library(rgdal)
library(sp)
library(mapproj)
library(tidyverse)
```

#Load package to retrieve raster map from Google Maps
```{r}
library(ggmap) #to use this package, need to register with Google and use Maps Static API, Geocoding API & maybe Geolocation API
```

```{r}
daily<-read.csv2("C:/Users/Morganak/Documents/R/COVID_Project/COVID-19/csse_covid_19_data/csse_covid_19_daily_reports/03-22-2020.csv", header=TRUE, sep=",", stringsAsFactors=FALSE)

str(daily)
names(daily)
colnames(daily)<-c('State','Country','Date','Confirmed', 'Deaths', 'Recover', 'Lat', 'Long')

#Filtering to only US confirmed cases
us_only<-daily %>% dplyr::filter(Country=="US") %>% dplyr::select('Confirmed','Lat', 'Long')
us_only$Lat<-as.numeric(us_only$Lat)
us_only$Long<-as.numeric(us_only$Long)


#Getting a map of the United States
map<-get_map(location = 'US', zoom=4, maptype = "roadmap")
#Adding points for confirmed cases
us_point<-ggmap(map) + geom_point(data=us_only, aes(x=Long, y=Lat), size=2, alpha=.5)
us_point
```
